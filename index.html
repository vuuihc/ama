<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="/ama/7dyk/libs/flexible.js"></script>
    <script type="text/javascript" src="/ama/7dyk/libs/vconsole.min.js"></script>
    <script   src="/ama/7dyk/libs/zepto.min.js" ></script>
    <script   src="/ama/7dyk/libs/jr-qrcode.min.js" ></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <title>七点一刻</title>
  </head>
  <body>
    <div id="root">
    </div>
    <script>
      var wx_config = {};//全局变量
      var entryUrl = location.href;
      console.log("entryUrl==="+entryUrl)
      function getWxConfig(){
        fetch(`http://api.7dyk.com/api/v1/question/test`,{
          //credentials: 'same-origin',
          method: 'post',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            url:entryUrl
          })
        })
            .then(function(response){ return  response.json()})
            .then(function(json){
              var data = json.data;
              var jsApiList = [
                  'startRecord',
                  'stopRecord',
                  'onVoiceRecordEnd',
                  'playVoice',
                  'pauseVoice',
                  'stopVoice',
                  'onVoicePlayEnd',
                  'uploadVoice',
                  'chooseWXPay'
              ]
//              wx_config['url'] = "http://h5app.7dyk.com/ama/7dyk/";
              wx_config['debug'] = false;
//              wx_config['url'] = "http://localhost:8080/";
              wx_config['appId'] = data['appId'];
              wx_config['timestamp'] = data['timestamp'];
              wx_config['nonceStr'] = data['nonceStr'];
              wx_config['signature'] = data['signature'];
              wx_config['jsApiList'] = jsApiList;
              console.log(wx_config);
              wx.config(wx_config);
            })
      }
      window.onload = function () {
        getWxConfig();
        wx.ready(function(){
          alert('wxapi is ready')
          console.log('wxapi is ready')
        })
        wx.error(function (res) {
          alert("error is "+res)
          console.log("error is "+JSON.stringify(res))
        })
      }
    </script>
    <script src="/ama/7dyk/dist/mobile.js"></script>
    <!--<script src="http://localhost:8080/assets/mobile.js"></script>-->
  </body>
</html>
