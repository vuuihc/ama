webpackHotUpdate(0,{96:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e){return{questionInfo:e.questionInfo,listenInfo:e.listenInfo}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(1),c=a(u),d=n(6),f=n(7),m=n(20),p=n(64),h=a(p),v=n(21),y=a(v),E=n(5);n(164);var g=n(94),b=a(g),_=function(e){function t(e){i(this,t);var n=s(this,Object.getPrototypeOf(t).call(this,e));return n.state={playing:0,answerAudio:null,curAnswerId:null,playNow:!0,listenTimer:null},n.handlePrise=n.handlePrise.bind(n),n}return l(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this.props.params.id;this.props.getQuestionInfo(e)}},{key:"componentWillUnmount",value:function(){var e=this;clearTimeout(e.state.listenTimer)}},{key:"getListenInfo",value:function(e,t){fetch(E.domain+"/api/v1/answer/listen?answer_id="+e,{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){return t(e)})}},{key:"payForAnswer",value:function(e){var t=this,n=this;this.setState({loading:!0}),this.getListenInfo(e,function(e){if(0==e.errCode){t.setState({loading:!1});var a=new Date;a.valueOf()/1e3-e.data.timeStamp<5&&!function(){var t=function a(){WeixinJSBridge.invoke("getBrandWCPayRequest",e.data,function(e){"get_brand_wcpay_request:ok"==e.err_msg?(n.setState({paySuccess:!0}),n.props.getQuestionInfo(n.props.questionInfo.question_id)):console.log(e),document.removeEventListener?document.removeEventListener("WeixinJSBridgeReady",a):document.attachEvent&&(document.detachEvent("WeixinJSBridgeReady",a),document.detachEvent("onWeixinJSBridgeReady",a))})};console.log("进入微信支付"),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t()}()}})}},{key:"getAudio",value:function(e){var t=this,n=this;this.setState({loading:!0}),this.getListenInfo(e,function(a){if(t.setState({loading:!1}),a.data.timeStamp)setTimeout(function(){n.getAudio(e)},500);else if(a.data.url){var i=t.props.params.id;if(a.data.question_id==i){var s=new Audio(a.data.url);n.setState({answerAudio:s}),n.playAudio(s)}}})}},{key:"playAudio",value:function(e,t){var n=this.state.answerAudio||t;n?(console.log("audio.src===="+n.src),n.play()):this.getAudio(e)}},{key:"bubbleClick",value:function(e,t){this.state.paySuccess||t?(this.setState({playing:1}),this.playAudio(e)):this.payForAnswer(e)}},{key:"handlePrise",value:function(e){this.props.priseQuestion(e)}},{key:"render",value:function(){var e=this,t=this.props.questionInfo;console.log("this.state.playing=="+this.state.playing);var n={0:" ",1:" playing"};return t.question_content?c["default"].createElement("main",{className:"question"},c["default"].createElement(y["default"],{icon:"loading",show:this.state.loading},t.answer_ispayed||this.state.paySuccess?"加载声音中……":"请求支付中……"),c["default"].createElement(d.Link,{to:E.baseUrl+"user/"+t.user_id},c["default"].createElement("div",{className:"userInfo"},c["default"].createElement("img",{src:t.user_face}),c["default"].createElement("span",null,t.user_name),c["default"].createElement("div",{className:"share"},"问题不错,快分享出去吧！",c["default"].createElement("i",{className:"iconfont icon-arrow"})))),c["default"].createElement("div",{className:"question-content"},t.question_content),c["default"].createElement("div",{className:"tutor"},c["default"].createElement("img",{src:t.teacher_face}),c["default"].createElement("h3",null,t.teacher_name),c["default"].createElement("h4",null,t.teacher_company+"　"+t.teacher_position,"  ")),"1"==t.isanswered?c["default"].createElement("div",null,c["default"].createElement("div",{className:"answer",onClick:this.bubbleClick.bind(this,t.answer_id,t.answer_ispayed)},c["default"].createElement("span",{className:"bubble"+n[this.state.playing]},c["default"].createElement("span",{className:"bubble-tail"}),c["default"].createElement(h["default"],null),c["default"].createElement("span",{className:"bubble-voice"}),c["default"].createElement("span",{className:"bubble-text"},t.answer_ispayed||this.state.paySuccess?1==this.state.playing?"正在播放":"点击播放":t.question_prize+"元偷偷听"))),c["default"].createElement("div",{className:"remark"},c["default"].createElement("span",null,t.answer_listen,"人偷听"),c["default"].createElement("span",{className:"kui"},t.answer_like,"人觉得赞"),0===t.answer_isliked?c["default"].createElement("div",{className:"prise",onClick:function(){e.handlePrise(t.answer_id)}},c["default"].createElement("div",null,c["default"].createElement("i",{className:"iconfont icon-zanNo"})),c["default"].createElement("div",{className:"desc"},"赞")):c["default"].createElement("div",{className:"prise"},c["default"].createElement("div",null,c["default"].createElement("i",{className:"iconfont icon-zanYes"})),c["default"].createElement("div",{className:"desc"},"已赞")))):c["default"].createElement("div",{className:"not-answer"},"等待老师回答……"),c["default"].createElement("div",{className:"ask"},c["default"].createElement("div",{className:"value"},"￥",t.teacher_prize),c["default"].createElement(d.Link,{className:"bottom-btn",to:E.baseUrl+"tutor/"+t.teacher_id},"向TA提问"))):c["default"].createElement(b["default"],null)}}]),t}(u.Component);_.propTypes={questionInfo:u.PropTypes.shape({}).isRequired,listenInfo:u.PropTypes.shape({}).isRequired},t["default"]=(0,f.connect)(r,{priseQuestion:m.priseQuestion,getQuestionInfo:m.getQuestionInfo})(_)}});
//# sourceMappingURL=0.13812c4bc9c6530a41b8.hot-update.js.map