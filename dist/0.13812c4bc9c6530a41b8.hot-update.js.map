{"version":3,"sources":["webpack:///0.13812c4bc9c6530a41b8.hot-update.js","webpack:///./src/javascripts/containers/Question.js?bf09"],"names":["webpackHotUpdate","96","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","mapStateToProps","state","questionInfo","listenInfo","defineProperty","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","_react","_react2","_reactRouter","_reactRedux","_question","_VoiceWave","_VoiceWave2","_toast","_toast2","_config","_Loading","_Loading2","Question","_Component","this","_this","getPrototypeOf","playing","answerAudio","curAnswerId","playNow","listenTimer","handlePrise","bind","id","params","getQuestionInfo","clearTimeout","answerId","cb","fetch","domain","credentials","then","response","json","_this2","setState","loading","getListenInfo","errCode","time","Date","valueOf","data","timeStamp","onBridgeReady","WeixinJSBridge","invoke","res","err_msg","paySuccess","question_id","console","log","document","removeEventListener","attachEvent","detachEvent","addEventListener","_this3","setTimeout","getAudio","url","questionId","Audio","playAudio","audio","src","play","isPayed","payForAnswer","priseQuestion","_this4","classNames","0","1","question_content","createElement","className","icon","show","answer_ispayed","Link","to","baseUrl","user_id","user_face","user_name","teacher_face","teacher_name","teacher_company","teacher_position","isanswered","onClick","bubbleClick","answer_id","question_prize","answer_listen","answer_like","answer_isliked","teacher_prize","teacher_id","Component","propTypes","PropTypes","shape","isRequired","connect"],"mappings":"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","file":"0.13812c4bc9c6530a41b8.hot-update.js","sourcesContent":["webpackHotUpdate(0,{\n\n/***/ 96:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _react = __webpack_require__(1);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _reactRouter = __webpack_require__(6);\n\t\n\tvar _reactRedux = __webpack_require__(7);\n\t\n\tvar _question = __webpack_require__(20);\n\t\n\tvar _VoiceWave = __webpack_require__(64);\n\t\n\tvar _VoiceWave2 = _interopRequireDefault(_VoiceWave);\n\t\n\tvar _toast = __webpack_require__(21);\n\t\n\tvar _toast2 = _interopRequireDefault(_toast);\n\t\n\tvar _config = __webpack_require__(5);\n\t\n\t__webpack_require__(164);\n\t\n\tvar _Loading = __webpack_require__(94);\n\t\n\tvar _Loading2 = _interopRequireDefault(_Loading);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /**\r\n\t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Created by zhushihao on 2016/6/14.\r\n\t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */\n\t\n\t\n\tvar Question = function (_Component) {\n\t  _inherits(Question, _Component);\n\t\n\t  function Question(props) {\n\t    _classCallCheck(this, Question);\n\t\n\t    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Question).call(this, props));\n\t\n\t    _this.state = {\n\t      playing: 0,\n\t      answerAudio: null,\n\t      curAnswerId: null,\n\t      playNow: true,\n\t      listenTimer: null\n\t    };\n\t    _this.handlePrise = _this.handlePrise.bind(_this);\n\t    return _this;\n\t  }\n\t\n\t  _createClass(Question, [{\n\t    key: 'componentDidMount',\n\t    value: function componentDidMount() {\n\t      var id = this.props.params.id;\n\t\n\t      this.props.getQuestionInfo(id);\n\t    }\n\t  }, {\n\t    key: 'componentWillUnmount',\n\t    value: function componentWillUnmount() {\n\t      var self = this;\n\t      clearTimeout(self.state.listenTimer);\n\t    }\n\t  }, {\n\t    key: 'getListenInfo',\n\t    value: function getListenInfo(answerId, cb) {\n\t      fetch(_config.domain + '/api/v1/answer/listen?answer_id=' + answerId, {\n\t        credentials: 'same-origin'\n\t      }).then(function (response) {\n\t        return response.json();\n\t      }).then(function (json) {\n\t        return cb(json);\n\t      });\n\t    }\n\t  }, {\n\t    key: 'payForAnswer',\n\t    value: function payForAnswer(answerId) {\n\t      var _this2 = this;\n\t\n\t      var self = this;\n\t      this.setState({ loading: true });\n\t      this.getListenInfo(answerId, function (json) {\n\t        if (json.errCode == 0) {\n\t          _this2.setState({ loading: false });\n\t          var time = new Date();\n\t          if (time.valueOf() / 1000 - json.data.timeStamp < 5) {\n\t            (function () {\n\t              var onBridgeReady = function onBridgeReady() {\n\t                WeixinJSBridge.invoke('getBrandWCPayRequest', json.data, function (res) {\n\t                  if (res.err_msg == \"get_brand_wcpay_request:ok\") {\n\t                    self.setState({ paySuccess: true });\n\t                    self.props.getQuestionInfo(self.props.questionInfo.question_id);\n\t                    // self.state.listenTimer = setTimeout(() => self.props.dispatch(getQuestionInfo(answerId)),1000);\n\t                    // self.setState({playNow: false})\n\t                  } else {\n\t                    console.log(res);\n\t                    // alert(\"支付失败，原因：\"+JSON.stringify(res))\n\t                    //     console.log(\"失败原因：\")\n\t                  }\n\t                  if (document.removeEventListener) {\n\t                    document.removeEventListener('WeixinJSBridgeReady', onBridgeReady);\n\t                  } else if (document.attachEvent) {\n\t                    document.detachEvent('WeixinJSBridgeReady', onBridgeReady);\n\t                    document.detachEvent('onWeixinJSBridgeReady', onBridgeReady);\n\t                  }\n\t                  // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。\n\t                });\n\t              };\n\t\n\t              console.log(\"进入微信支付\");\n\t\n\t              if (typeof WeixinJSBridge == \"undefined\") {\n\t                if (document.addEventListener) {\n\t                  document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\n\t                } else if (document.attachEvent) {\n\t                  document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\n\t                  document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\n\t                }\n\t              } else {\n\t                onBridgeReady();\n\t              }\n\t            })();\n\t          }\n\t        }\n\t      });\n\t    }\n\t  }, {\n\t    key: 'getAudio',\n\t    value: function getAudio(answerId) {\n\t      var _this3 = this;\n\t\n\t      var self = this;\n\t      this.setState({ loading: true });\n\t      this.getListenInfo(answerId, function (json) {\n\t        _this3.setState({ loading: false });\n\t        if (json.data.timeStamp) {\n\t          setTimeout(function () {\n\t            //todo 优化\n\t            self.getAudio(answerId);\n\t          }, 500);\n\t        } else if (json.data.url) {\n\t          var questionId = _this3.props.params.id;\n\t          if (json.data.question_id == questionId) {\n\t            var answerAudio = new Audio(json.data.url);\n\t            self.setState({ answerAudio: answerAudio });\n\t            self.playAudio(answerAudio);\n\t          }\n\t        }\n\t      });\n\t    }\n\t  }, {\n\t    key: 'playAudio',\n\t    value: function playAudio(answerId, answerAudio) {\n\t      var audio = this.state.answerAudio || answerAudio;\n\t      if (audio) {\n\t        console.log(\"audio.src====\" + audio.src);\n\t        audio.play(); //todo 优化\n\t      } else {\n\t        this.getAudio(answerId);\n\t      }\n\t    }\n\t  }, {\n\t    key: 'bubbleClick',\n\t    value: function bubbleClick(answerId, isPayed) {\n\t      if (this.state.paySuccess || isPayed) {\n\t        this.setState({ playing: 1 });\n\t        this.playAudio(answerId);\n\t      } else {\n\t        this.payForAnswer(answerId);\n\t      }\n\t    }\n\t  }, {\n\t    key: 'handlePrise',\n\t    value: function handlePrise(answerId) {\n\t      this.props.priseQuestion(answerId);\n\t    }\n\t  }, {\n\t    key: 'render',\n\t    value: function render() {\n\t      var _this4 = this;\n\t\n\t      var questionInfo = this.props.questionInfo;\n\t\n\t      console.log(\"this.state.playing==\" + this.state.playing);\n\t      var classNames = {\n\t        0: \" \",\n\t        1: \" playing\"\n\t      };\n\t\n\t      return questionInfo.question_content ? _react2.default.createElement(\n\t        'main',\n\t        { className: 'question' },\n\t        _react2.default.createElement(\n\t          _toast2.default,\n\t          { icon: 'loading', show: this.state.loading },\n\t          questionInfo.answer_ispayed || this.state.paySuccess ? \"加载声音中……\" : \"请求支付中……\"\n\t        ),\n\t        _react2.default.createElement(\n\t          _reactRouter.Link,\n\t          { to: _config.baseUrl + 'user/' + questionInfo.user_id },\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'userInfo' },\n\t            _react2.default.createElement('img', { src: questionInfo.user_face }),\n\t            _react2.default.createElement(\n\t              'span',\n\t              null,\n\t              questionInfo.user_name\n\t            ),\n\t            _react2.default.createElement(\n\t              'div',\n\t              { className: 'share' },\n\t              '问题不错,快分享出去吧！',\n\t              _react2.default.createElement('i', { className: 'iconfont icon-arrow' })\n\t            )\n\t          )\n\t        ),\n\t        _react2.default.createElement(\n\t          'div',\n\t          { className: 'question-content' },\n\t          questionInfo.question_content\n\t        ),\n\t        _react2.default.createElement(\n\t          'div',\n\t          { className: 'tutor' },\n\t          _react2.default.createElement('img', { src: questionInfo.teacher_face }),\n\t          _react2.default.createElement(\n\t            'h3',\n\t            null,\n\t            questionInfo.teacher_name\n\t          ),\n\t          _react2.default.createElement(\n\t            'h4',\n\t            null,\n\t            questionInfo.teacher_company + \"　\" + questionInfo.teacher_position,\n\t            '  '\n\t          )\n\t        ),\n\t        questionInfo.isanswered == '1' ? _react2.default.createElement(\n\t          'div',\n\t          null,\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'answer', onClick: this.bubbleClick.bind(this, questionInfo.answer_id, questionInfo.answer_ispayed) },\n\t            _react2.default.createElement(\n\t              'span',\n\t              { className: 'bubble' + classNames[this.state.playing] },\n\t              _react2.default.createElement('span', { className: 'bubble-tail' }),\n\t              _react2.default.createElement(_VoiceWave2.default, null),\n\t              _react2.default.createElement('span', { className: 'bubble-voice' }),\n\t              _react2.default.createElement(\n\t                'span',\n\t                { className: 'bubble-text' },\n\t                questionInfo.answer_ispayed || this.state.paySuccess ? this.state.playing == 1 ? \"正在播放\" : \"点击播放\" : questionInfo.question_prize + '元偷偷听'\n\t              )\n\t            )\n\t          ),\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'remark' },\n\t            _react2.default.createElement(\n\t              'span',\n\t              null,\n\t              questionInfo.answer_listen,\n\t              '人偷听'\n\t            ),\n\t            _react2.default.createElement(\n\t              'span',\n\t              { className: 'kui' },\n\t              questionInfo.answer_like,\n\t              '人觉得赞'\n\t            ),\n\t            questionInfo.answer_isliked === 0 ? _react2.default.createElement(\n\t              'div',\n\t              { className: 'prise', onClick: function onClick() {\n\t                  _this4.handlePrise(questionInfo.answer_id);\n\t                } },\n\t              _react2.default.createElement(\n\t                'div',\n\t                null,\n\t                _react2.default.createElement('i', { className: 'iconfont icon-zanNo' })\n\t              ),\n\t              _react2.default.createElement(\n\t                'div',\n\t                { className: 'desc' },\n\t                '赞'\n\t              )\n\t            ) : _react2.default.createElement(\n\t              'div',\n\t              { className: 'prise' },\n\t              _react2.default.createElement(\n\t                'div',\n\t                null,\n\t                _react2.default.createElement('i', { className: 'iconfont icon-zanYes' })\n\t              ),\n\t              _react2.default.createElement(\n\t                'div',\n\t                { className: 'desc' },\n\t                '已赞'\n\t              )\n\t            )\n\t          )\n\t        ) : _react2.default.createElement(\n\t          'div',\n\t          { className: 'not-answer' },\n\t          '等待老师回答……'\n\t        ),\n\t        _react2.default.createElement(\n\t          'div',\n\t          { className: 'ask' },\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'value' },\n\t            '￥',\n\t            questionInfo.teacher_prize\n\t          ),\n\t          _react2.default.createElement(\n\t            _reactRouter.Link,\n\t            { className: 'bottom-btn', to: _config.baseUrl + \"tutor/\" + questionInfo.teacher_id },\n\t            '向TA提问'\n\t          )\n\t        )\n\t      ) : _react2.default.createElement(_Loading2.default, null);\n\t    }\n\t  }]);\n\t\n\t  return Question;\n\t}(_react.Component);\n\t\n\tQuestion.propTypes = {\n\t  questionInfo: _react.PropTypes.shape({}).isRequired,\n\t  listenInfo: _react.PropTypes.shape({}).isRequired\n\t};\n\t\n\tfunction mapStateToProps(state) {\n\t  return {\n\t    questionInfo: state.questionInfo,\n\t    listenInfo: state.listenInfo\n\t  };\n\t}\n\t\n\texports.default = (0, _reactRedux.connect)(mapStateToProps, {\n\t  priseQuestion: _question.priseQuestion,\n\t  getQuestionInfo: _question.getQuestionInfo\n\t})(Question);\n\n/***/ }\n\n})\n\n\n/** WEBPACK FOOTER **\n ** 0.13812c4bc9c6530a41b8.hot-update.js\n **/","/**\r\n * Created by zhushihao on 2016/6/14.\r\n */\r\nimport React, {Component, PropTypes} from 'react'\r\nimport {Link} from 'react-router'\r\nimport {connect} from 'react-redux'\r\nimport {getQuestionInfo, priseQuestion} from '../actions/question.js'\r\nimport VoiceWave from \"../components/VoiceWave\"\r\nimport Toast from \"../util/weui/toast\"\r\nimport {baseUrl,domain} from \"../api/config\"\r\nimport '../../stylesheets/partials/modules/Question.scss'\r\nimport Loading from \"./Loading\"\r\nclass Question extends Component {\r\n  constructor(props){\r\n    super(props)\r\n    this.state={\r\n      playing: 0,\r\n      answerAudio:null,\r\n      curAnswerId:null,\r\n      playNow: true,\r\n      listenTimer:null,\r\n    }\r\n    this.handlePrise = this.handlePrise.bind(this);\r\n  }\r\n  componentDidMount() {\r\n    const {id} = this.props.params\r\n    this.props.getQuestionInfo(id);\r\n  }\r\n  componentWillUnmount(){\r\n    const self = this\r\n    clearTimeout(self.state.listenTimer);\r\n  }\r\n  getListenInfo(answerId,cb) {\r\n    fetch(`${domain}/api/v1/answer/listen?answer_id=${answerId}`, {\r\n      credentials: 'same-origin'\r\n    })\r\n      .then(response => response.json())\r\n      .then(json => cb(json))\r\n  }\r\n\r\n  payForAnswer(answerId){\r\n    const self = this\r\n    this.setState({loading: true})\r\n    this.getListenInfo(answerId,json => {\r\n        if(json.errCode==0){\r\n          this.setState({loading: false})\r\n          const time = new Date()\r\n          if(time.valueOf()/1000-json.data.timeStamp<5){\r\n            console.log(\"进入微信支付\")\r\n            function onBridgeReady(){\r\n              WeixinJSBridge.invoke(\r\n                'getBrandWCPayRequest', json.data,\r\n                function(res){\r\n                  if(res.err_msg == \"get_brand_wcpay_request:ok\" ) {\r\n                    self.setState({paySuccess:true});\r\n                    self.props.getQuestionInfo(self.props.questionInfo.question_id);\r\n                    // self.state.listenTimer = setTimeout(() => self.props.dispatch(getQuestionInfo(answerId)),1000);\r\n                    // self.setState({playNow: false})\r\n                  }else{\r\n                    console.log(res)\r\n                    // alert(\"支付失败，原因：\"+JSON.stringify(res))\r\n                    //     console.log(\"失败原因：\")\r\n                  }\r\n                  if( document.removeEventListener ){\r\n                    document.removeEventListener('WeixinJSBridgeReady', onBridgeReady);\r\n                  }else if (document.attachEvent){\r\n                    document.detachEvent('WeixinJSBridgeReady', onBridgeReady);\r\n                    document.detachEvent('onWeixinJSBridgeReady', onBridgeReady);\r\n                  }\r\n                  // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。\r\n                }\r\n              );\r\n            }\r\n            if (typeof WeixinJSBridge == \"undefined\"){\r\n              if( document.addEventListener ){\r\n                document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\r\n              }else if (document.attachEvent){\r\n                document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\r\n                document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\r\n              }\r\n            }else{\r\n              onBridgeReady();\r\n            }\r\n          }\r\n        }\r\n      })\r\n  }\r\n  getAudio(answerId){\r\n    const self =this\r\n    this.setState({loading: true})\r\n    this.getListenInfo(answerId,json => {\r\n      this.setState({loading: false})\r\n      if(json.data.timeStamp){\r\n        setTimeout(function(){//todo 优化\r\n          self.getAudio(answerId)\r\n        },500)\r\n      }else if(json.data.url){\r\n        const questionId = this.props.params.id\r\n        if(json.data.question_id==questionId){\r\n          const answerAudio = new Audio(json.data.url)\r\n          self.setState({answerAudio:answerAudio})\r\n          self.playAudio(answerAudio)\r\n        }\r\n      }\r\n    })\r\n  }\r\n  playAudio(answerId,answerAudio){\r\n    let audio = this.state.answerAudio || answerAudio\r\n    if(audio){\r\n      console.log(\"audio.src====\"+audio.src)\r\n      audio.play();//todo 优化\r\n    }else{\r\n      this.getAudio(answerId)\r\n    }\r\n  }\r\n  bubbleClick(answerId,isPayed){\r\n    if(this.state.paySuccess || isPayed ){\r\n      this.setState({playing:1})\r\n      this.playAudio(answerId)\r\n    }else{\r\n      this.payForAnswer(answerId)\r\n    }\r\n  }\r\n  handlePrise(answerId){\r\n    this.props.priseQuestion(answerId);\r\n  }\r\n\r\n  render() {\r\n    const {questionInfo} = this.props\r\n    console.log(\"this.state.playing==\"+this.state.playing)\r\n    const classNames = {\r\n      0: \" \",\r\n      1: \" playing\"\r\n    }\r\n\r\n    return ( questionInfo.question_content ? \r\n      <main className=\"question\">\r\n        <Toast icon=\"loading\" show={this.state.loading} >{(questionInfo.answer_ispayed || this.state.paySuccess)?\"加载声音中……\":\"请求支付中……\"}</Toast>\r\n        <Link to = {`${baseUrl}user/${questionInfo.user_id}`} >\r\n          <div className=\"userInfo\">\r\n            <img src={questionInfo.user_face} />\r\n            <span>{questionInfo.user_name}</span>\r\n            <div className=\"share\">问题不错,快分享出去吧！<i className=\"iconfont icon-arrow\" /></div>\r\n          </div>\r\n        </Link>\r\n        <div className=\"question-content\">\r\n          {questionInfo.question_content}\r\n        </div>\r\n        <div className=\"tutor\">\r\n          <img src={questionInfo.teacher_face}/>\r\n          <h3 >{questionInfo.teacher_name}</h3>\r\n          <h4 >{questionInfo.teacher_company+\"　\"+questionInfo.teacher_position}  </h4>\r\n        </div>\r\n\r\n        {\r\n          questionInfo.isanswered == '1' ? (\r\n            <div>\r\n              <div className=\"answer\" onClick={this.bubbleClick.bind(this,questionInfo.answer_id,questionInfo.answer_ispayed)}>\r\n                <span className={`bubble${classNames[this.state.playing]}`}>\r\n                <span className=\"bubble-tail\"></span>\r\n                <VoiceWave />\r\n                <span className=\"bubble-voice\"></span>\r\n                <span className=\"bubble-text\">{(questionInfo.answer_ispayed || this.state.paySuccess)?(this.state.playing==1?\"正在播放\":\"点击播放\"):`${questionInfo.question_prize}元偷偷听`}</span>\r\n              </span>\r\n              </div>\r\n              <div className=\"remark\">\r\n                <span>{questionInfo.answer_listen}人偷听</span>\r\n                <span className=\"kui\">{questionInfo.answer_like}人觉得赞</span>\r\n                {\r\n                  questionInfo.answer_isliked === 0\r\n                    ? <div className=\"prise\" onClick={() => {this.handlePrise(questionInfo.answer_id)}}>\r\n                    <div><i className=\"iconfont icon-zanNo\" /></div>\r\n                    <div className=\"desc\">赞</div>\r\n                  </div>\r\n                    : <div className=\"prise\">\r\n                    <div><i className=\"iconfont icon-zanYes\" /></div>\r\n                    <div className=\"desc\">已赞</div>\r\n                  </div>\r\n                }\r\n              </div>\r\n            </div>) : (<div className=\"not-answer\">等待老师回答……</div>)\r\n        }\r\n\r\n\r\n        <div className=\"ask\">\r\n          <div className=\"value\">￥{questionInfo.teacher_prize}</div>\r\n          <Link className=\"bottom-btn\" to={baseUrl+\"tutor/\"+questionInfo.teacher_id}>向TA提问</Link>\r\n        </div>\r\n      </main>\r\n        :\r\n      <Loading />\r\n    )\r\n  }\r\n}\r\n\r\nQuestion.propTypes = {\r\n  questionInfo: PropTypes.shape({}).isRequired,\r\n  listenInfo: PropTypes.shape({}).isRequired,\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    questionInfo: state.questionInfo,\r\n    listenInfo: state.listenInfo\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  {\r\n    priseQuestion,\r\n    getQuestionInfo,\r\n  }\r\n)(Question)\n\n\n/** WEBPACK FOOTER **\n ** ./src/javascripts/containers/Question.js\n **/"],"sourceRoot":""}