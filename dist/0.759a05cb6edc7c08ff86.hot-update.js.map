{"version":3,"sources":["webpack:///0.759a05cb6edc7c08ff86.hot-update.js","webpack:///./src/javascripts/containers/TutorIndex.js?8b7a"],"names":["webpackHotUpdate","97","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","mapStateToProps","state","tutorInfo","tutorAnswerList","prepayInfo","defineProperty","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","_react","_react2","_reactRouter","_reactRedux","_tutor","_account","_QuestionItemWithoutAvatar","_QuestionItemWithoutAvatar2","_Loading","_Loading2","_toast","_toast2","_config","TutorIndex","_Component","this","_this","getPrototypeOf","curPage","askSuccess","loading","routerWillLeave","bind","content","tutorId","_this2","url","domain","setState","fetch","credentials","then","response","json","undefined","data","timeStamp","onBridgeReady","WeixinJSBridge","invoke","res","err_msg","console","log","dispatch","getIAsked","successTimer","setTimeout","browserHistory","push","baseUrl","alert","document","removeEventListener","attachEvent","detachEvent","addEventListener","refs","id","params","getPrepayInfo","payForAsk","onScroll","e","window","scrollY","innerHeight","body","clientHeight","completed","getTutorAnswerList","getTutorInfo","router","setRouteLeaveHook","route","nextLocation","clearTimeout","_props","createElement","className","show","icon","Link","to","user_id","src","user_face","user_name","user_title","user_introduction","teacher_income","listen_num","ref","placeholder","teacher_prize","onClick","askBtnClick","map","question","index","head","Component","withRouter","propTypes","PropTypes","shape","isRequired","contextTypes","object","connect"],"mappings":"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","file":"0.759a05cb6edc7c08ff86.hot-update.js","sourcesContent":["webpackHotUpdate(0,{\n\n/***/ 97:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _react = __webpack_require__(1);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _reactRouter = __webpack_require__(6);\n\t\n\tvar _reactRedux = __webpack_require__(7);\n\t\n\tvar _tutor = __webpack_require__(27);\n\t\n\tvar _account = __webpack_require__(12);\n\t\n\tvar _QuestionItemWithoutAvatar = __webpack_require__(66);\n\t\n\tvar _QuestionItemWithoutAvatar2 = _interopRequireDefault(_QuestionItemWithoutAvatar);\n\t\n\tvar _Loading = __webpack_require__(16);\n\t\n\tvar _Loading2 = _interopRequireDefault(_Loading);\n\t\n\tvar _toast = __webpack_require__(21);\n\t\n\tvar _toast2 = _interopRequireDefault(_toast);\n\t\n\tvar _config = __webpack_require__(5);\n\t\n\t__webpack_require__(169);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /**\r\n\t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Created by zhushihao on 2016/6/15.\r\n\t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */\n\t\n\t\n\tvar TutorIndex = function (_Component) {\n\t  _inherits(TutorIndex, _Component);\n\t\n\t  function TutorIndex(props) {\n\t    _classCallCheck(this, TutorIndex);\n\t\n\t    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(TutorIndex).call(this, props));\n\t\n\t    _this.state = {\n\t      curPage: 1,\n\t      askSuccess: false,\n\t      loading: false\n\t    };\n\t    _this.routerWillLeave = _this.routerWillLeave.bind(_this);\n\t    return _this;\n\t  }\n\t\n\t  _createClass(TutorIndex, [{\n\t    key: 'payForAsk',\n\t    value: function payForAsk(content, tutorId) {\n\t      var _this2 = this;\n\t\n\t      var url = _config.domain + ('/api/v1/question/testquestion?content=' + content + '&answer_user_id=' + tutorId);\n\t      this.setState({ loading: true });\n\t      fetch(url, {\n\t        credentials: 'same-origin'\n\t      }).then(function (response) {\n\t        return response.json();\n\t      }).then(function (json) {\n\t        _this2.setState({ loading: false });\n\t        var self = _this2;\n\t        if (json.data.timeStamp != undefined) {\n\t          (function () {\n\t            var onBridgeReady = function onBridgeReady() {\n\t              WeixinJSBridge.invoke('getBrandWCPayRequest', json.data, function (res) {\n\t                if (res.err_msg == \"get_brand_wcpay_request:ok\") {\n\t                  console.log(\"支付成功！\");\n\t                  self.setState({ askSuccess: true });\n\t                  self.props.dispatch((0, _account.getIAsked)(1, 10));\n\t                  var successTimer = setTimeout(function () {\n\t                    _reactRouter.browserHistory.push(_config.baseUrl + \"account/IAskedList\");\n\t                  }, 2000);\n\t                  self.setState({ successTimer: successTimer });\n\t                } else {\n\t                  console.log(res);\n\t                  alert(\"支付失败\");\n\t                }\n\t                if (document.removeEventListener) {\n\t                  document.removeEventListener('WeixinJSBridgeReady', onBridgeReady);\n\t                } else if (document.attachEvent) {\n\t                  document.detachEvent('WeixinJSBridgeReady', onBridgeReady);\n\t                  document.detachEvent('onWeixinJSBridgeReady', onBridgeReady);\n\t                }\n\t\n\t                // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。\n\t              });\n\t            };\n\t\n\t            if (typeof WeixinJSBridge == \"undefined\") {\n\t              if (document.addEventListener) {\n\t                document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\n\t              } else if (document.attachEvent) {\n\t                document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\n\t                document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\n\t              }\n\t            } else {\n\t              onBridgeReady();\n\t            }\n\t          })();\n\t        }\n\t      });\n\t    }\n\t  }, {\n\t    key: 'askBtnClick',\n\t    value: function askBtnClick() {\n\t      var content = this.refs.content.value;\n\t      console.log(\"content is ===\" + content);\n\t      if (content == \"\") {\n\t        alert(\"内容不能为空哦\");\n\t        return;\n\t      }\n\t      var id = this.props.params.id;\n\t\n\t      this.props.dispatch((0, _tutor.getPrepayInfo)(content, id));\n\t      this.payForAsk(content, id);\n\t    }\n\t  }, {\n\t    key: 'componentDidMount',\n\t    value: function componentDidMount() {\n\t      var id = this.props.params.id;\n\t\n\t      this.props.dispatch((0, _tutor.getTutorInfo)(id));\n\t      this.props.dispatch((0, _tutor.getTutorAnswerList)(id, 1, 10));\n\t      function onScroll(e) {\n\t        if (window.scrollY + window.innerHeight == document.body.clientHeight && !this.props.tutorAnswerList.completed) {\n\t          var curPage = ++this.state.curPage;\n\t          this.setState({ curPage: curPage });\n\t          this.props.dispatch((0, _tutor.getTutorAnswerList)(id, curPage, 10));\n\t        }\n\t      }\n\t      this.props.router.setRouteLeaveHook(this.props.route, this.routerWillLeave);\n\t      document.addEventListener('scroll', onScroll.bind(this));\n\t    }\n\t  }, {\n\t    key: 'routerWillLeave',\n\t    value: function routerWillLeave(nextLocation) {\n\t      // return false to prevent a transition w/o prompting the user,\n\t      // or return a string to allow the user to decide:\n\t      if (this.refs.content.value != '' && !this.state.askSuccess) {\n\t        return '您的提问尚未支付，确认离开?';\n\t      }\n\t    }\n\t  }, {\n\t    key: 'componentWillUnmount',\n\t    value: function componentWillUnmount() {\n\t      clearTimeout(this.state.successTimer);\n\t    }\n\t  }, {\n\t    key: 'render',\n\t    value: function render() {\n\t      var _props = this.props;\n\t      var tutorInfo = _props.tutorInfo;\n\t      var tutorAnswerList = _props.tutorAnswerList;\n\t\n\t      return _react2.default.createElement(\n\t        'main',\n\t        { className: 'tutorIndex' },\n\t        _react2.default.createElement(\n\t          _toast2.default,\n\t          { show: this.state.askSuccess },\n\t          '提问成功'\n\t        ),\n\t        _react2.default.createElement(\n\t          _toast2.default,\n\t          { icon: 'loading', show: this.state.loading },\n\t          '请求支付中……'\n\t        ),\n\t        _react2.default.createElement(\n\t          'div',\n\t          { className: 'tutor-info' },\n\t          _react2.default.createElement(\n\t            _reactRouter.Link,\n\t            { to: _config.baseUrl + ('tutor/share/' + tutorInfo.user_id) },\n\t            _react2.default.createElement('img', { className: 'QREntry', src: __webpack_require__(82) })\n\t          ),\n\t          _react2.default.createElement('img', { className: 'avatar', src: tutorInfo.user_face }),\n\t          _react2.default.createElement(\n\t            'h3',\n\t            { className: 'tutor-name' },\n\t            tutorInfo.user_name\n\t          ),\n\t          _react2.default.createElement(\n\t            'h4',\n\t            { className: 'tutor-title' },\n\t            tutorInfo.user_title\n\t          ),\n\t          _react2.default.createElement(\n\t            'h5',\n\t            { className: 'tutor-intro' },\n\t            tutorInfo.user_introduction\n\t          ),\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'grade' },\n\t            _react2.default.createElement(\n\t              'div',\n\t              { className: 'num' },\n\t              _react2.default.createElement(\n\t                'span',\n\t                null,\n\t                '￥',\n\t                tutorInfo.teacher_income\n\t              ),\n\t              _react2.default.createElement(\n\t                'span',\n\t                null,\n\t                '￥',\n\t                tutorInfo.listen_num\n\t              )\n\t            ),\n\t            _react2.default.createElement(\n\t              'div',\n\t              { className: 'grade-name' },\n\t              _react2.default.createElement(\n\t                'span',\n\t                null,\n\t                '总收入'\n\t              ),\n\t              _react2.default.createElement(\n\t                'span',\n\t                null,\n\t                '被偷听'\n\t              )\n\t            )\n\t          ),\n\t          _react2.default.createElement('textarea', { ref: 'content', placeholder: \"向\" + tutorInfo.user_name + \"提问，等TA语音回答；超过24小时未回答，将按支付路径全额退款\" }),\n\t          _react2.default.createElement(\n\t            'div',\n\t            { className: 'value' },\n\t            '￥',\n\t            tutorInfo.teacher_prize\n\t          ),\n\t          _react2.default.createElement(\n\t            'a',\n\t            { className: 'bottom-btn', onClick: this.askBtnClick.bind(this) },\n\t            '向TA提问'\n\t          )\n\t        ),\n\t        _react2.default.createElement(\n\t          'div',\n\t          { className: 'question-list' },\n\t          _react2.default.createElement(\n\t            'h5',\n\t            { className: 'title' },\n\t            '他还回答了这些问题'\n\t          ),\n\t          tutorAnswerList.data.map(function (question, index) {\n\t            return _react2.default.createElement(_QuestionItemWithoutAvatar2.default, { head: tutorInfo.user_face, key: index, question: question });\n\t          }),\n\t          _react2.default.createElement(_Loading2.default, { completed: tutorAnswerList.completed })\n\t        )\n\t      );\n\t    }\n\t  }]);\n\t\n\t  return TutorIndex;\n\t}(_react.Component);\n\t\n\tTutorIndex = (0, _reactRouter.withRouter)(TutorIndex);\n\t\n\tTutorIndex.propTypes = {\n\t  tutorInfo: _react.PropTypes.shape({}).isRequired\n\t};\n\tTutorIndex.contextTypes = {\n\t  router: _react.PropTypes.object\n\t};\n\t\n\tfunction mapStateToProps(state) {\n\t  return {\n\t    tutorInfo: state.tutorInfo,\n\t    tutorAnswerList: state.tutorAnswerList,\n\t    prepayInfo: state.prepayInfo\n\t  };\n\t}\n\t\n\texports.default = (0, _reactRedux.connect)(mapStateToProps)(TutorIndex);\n\n/***/ }\n\n})\n\n\n/** WEBPACK FOOTER **\n ** 0.759a05cb6edc7c08ff86.hot-update.js\n **/","/**\r\n * Created by zhushihao on 2016/6/15.\r\n */\r\nimport React, {Component, PropTypes} from 'react'\r\nimport {Link,browserHistory} from 'react-router'\r\nimport {connect} from 'react-redux'\r\nimport {getTutorInfo,getTutorAnswerList,getPrepayInfo} from '../actions/tutor.js'\r\nimport {getIAsked} from '../actions/account.js'\r\nimport QuestionItemWithoutAvatar from \"./blocks/QuestionItemWithoutAvatar\"\r\nimport Loading from \"./Loading2\"\r\nimport Toast from \"../util/weui/toast\"\r\nimport {baseUrl,domain} from \"../api/config\"\r\nimport '../../stylesheets/partials/modules/TutorIndex.scss'\r\nimport { withRouter } from 'react-router'\r\n\r\n\r\nclass TutorIndex extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      curPage:1,\r\n      askSuccess:false,\r\n      loading:false\r\n    }\r\n\tthis.routerWillLeave = this.routerWillLeave.bind(this);\r\n  }\r\n  payForAsk(content,tutorId){\r\n    const url = domain + `/api/v1/question/testquestion?content=${content}&answer_user_id=${tutorId}`\r\n    this.setState({loading:true})\r\n    fetch(url,{\r\n      credentials: 'same-origin'\r\n    })\r\n      .then(response => response.json())\r\n      .then(json =>{\r\n        this.setState({loading:false})\r\n        const self =this\r\n        if(json.data.timeStamp!=undefined){\r\n          function onBridgeReady(){\r\n            WeixinJSBridge.invoke(\r\n              'getBrandWCPayRequest', json.data,\r\n              function(res){\r\n                if(res.err_msg == \"get_brand_wcpay_request:ok\" ) {\r\n                  console.log(\"支付成功！\")\r\n                  self.setState({askSuccess:true})\r\n                  self.props.dispatch(getIAsked(1, 10));\r\n                  let successTimer = setTimeout(()=>{\r\n                    browserHistory.push(baseUrl+\"account/IAskedList\")\r\n                  },2000)\r\n                  self.setState({successTimer:successTimer})\r\n                }else{\r\n                  console.log(res)\r\n                  alert(\"支付失败\")\r\n                }\r\n                if( document.removeEventListener ){\r\n                  document.removeEventListener('WeixinJSBridgeReady', onBridgeReady);\r\n                }else if (document.attachEvent){\r\n                  document.detachEvent('WeixinJSBridgeReady', onBridgeReady);\r\n                  document.detachEvent('onWeixinJSBridgeReady', onBridgeReady);\r\n                }\r\n\r\n                // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。\r\n              }\r\n            );\r\n          }\r\n          if (typeof WeixinJSBridge == \"undefined\"){\r\n            if( document.addEventListener ){\r\n              document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\r\n            }else if (document.attachEvent){\r\n              document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\r\n              document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\r\n            }\r\n          }else{\r\n            onBridgeReady();\r\n          }\r\n        }\r\n      })\r\n  }\r\n  askBtnClick(){\r\n    const content = this.refs.content.value\r\n    console.log(\"content is ===\"+content)\r\n    if(content==\"\"){\r\n      alert(\"内容不能为空哦\")\r\n      return\r\n    }\r\n    const {id} = this.props.params\r\n    this.props.dispatch(getPrepayInfo(content,id))\r\n    this.payForAsk(content,id)\r\n  }\r\n\r\n  componentDidMount() {\r\n    const {id} = this.props.params\r\n    this.props.dispatch(getTutorInfo(id))\r\n    this.props.dispatch(getTutorAnswerList(id,1,10))\r\n    function onScroll(e) {\r\n      if (window.scrollY + window.innerHeight == document.body.clientHeight && !this.props.tutorAnswerList.completed) {\r\n        const curPage = ++this.state.curPage;\r\n        this.setState({curPage});\r\n        this.props.dispatch(getTutorAnswerList(id,curPage, 10))\r\n      }\r\n    }\r\n    this.props.router.setRouteLeaveHook(this.props.route, this.routerWillLeave)\r\n    document.addEventListener('scroll', onScroll.bind(this));\r\n  }\r\n\r\n  routerWillLeave(nextLocation) {\r\n    // return false to prevent a transition w/o prompting the user,\r\n    // or return a string to allow the user to decide:\r\n    if(this.refs.content.value != '' && !this.state.askSuccess){\r\n      return '您的提问尚未支付，确认离开?'\r\n    }\r\n  }\r\n  componentWillUnmount(){\r\n    clearTimeout(this.state.successTimer)\r\n  }\r\n\r\n  render() {\r\n    const {tutorInfo,tutorAnswerList} = this.props\r\n    return (\r\n      <main className=\"tutorIndex\">\r\n        <Toast  show={this.state.askSuccess} >提问成功</Toast>\r\n        <Toast  icon=\"loading\" show={this.state.loading} >请求支付中……</Toast>\r\n        <div className=\"tutor-info\">\r\n          <Link to={baseUrl+`tutor/share/${tutorInfo.user_id}`} >\r\n            <img className=\"QREntry\" src={require(\"../../images/QREntry.png\")}/>\r\n          </Link>\r\n          <img className=\"avatar\" src={tutorInfo.user_face}/>\r\n          <h3 className=\"tutor-name\">{tutorInfo.user_name}</h3>\r\n          <h4 className=\"tutor-title\">{tutorInfo.user_title}</h4>\r\n          <h5 className=\"tutor-intro\">{tutorInfo.user_introduction}</h5>\r\n          <div className=\"grade\">\r\n            <div className=\"num\">\r\n              <span>￥{tutorInfo.teacher_income}</span>\r\n              <span>￥{tutorInfo.listen_num}</span>\r\n            </div>\r\n            <div className=\"grade-name\">\r\n              <span>总收入</span>\r\n              <span>被偷听</span>\r\n            </div>\r\n          </div>\r\n          <textarea ref=\"content\" placeholder={\"向\"+tutorInfo.user_name+\"提问，等TA语音回答；超过24小时未回答，将按支付路径全额退款\"}/>\r\n          <div className=\"value\">￥{tutorInfo.teacher_prize}</div>\r\n          <a className=\"bottom-btn\" onClick={this.askBtnClick.bind(this)}>向TA提问</a>\r\n\r\n        </div>\r\n        <div className=\"question-list\">\r\n          <h5 className=\"title\">他还回答了这些问题</h5>\r\n          {\r\n            tutorAnswerList.data.map((question,index) =>\r\n              <QuestionItemWithoutAvatar head={tutorInfo.user_face} key={index} question={question}/>\r\n            )\r\n          }\r\n           <Loading completed={tutorAnswerList.completed} />\r\n        </div>\r\n      </main>\r\n    )\r\n  }\r\n}\r\n\r\nTutorIndex = withRouter(TutorIndex)\r\n\r\nTutorIndex.propTypes = {\r\n  tutorInfo: PropTypes.shape({}).isRequired,\r\n}\r\nTutorIndex.contextTypes = {\r\n  router: PropTypes.object\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    tutorInfo: state.tutorInfo,\r\n    tutorAnswerList: state.tutorAnswerList,\r\n    prepayInfo: state.prepayInfo\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps\r\n)(TutorIndex)\n\n\n/** WEBPACK FOOTER **\n ** ./src/javascripts/containers/TutorIndex.js\n **/"],"sourceRoot":""}