webpackHotUpdate(0,{106:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=n(1),u=a(c),d=n(38),f=a(d),p=n(6),m=n(7);n(157);var v=n(20),g=n(12),h=n(63),w=n(67),y=a(w),b=n(64),E=a(b),S=n(21),k=a(S),C=n(5),T=function(e){function t(){s(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.state={localId:null,status:0,answerSuccess:!1,successTimer:null,START:0,END:0},e.clickHandler=e.clickHandler.bind(e),e.routerWillLeave=e.routerWillLeave.bind(e),e}return r(t,e),l(t,[{key:"componentWillMount",value:function(){var e=this.props.params.id;this.props.getQuestionInfo(e)}},{key:"componentDidMount",value:function(){this.refreshWXConfig(),console.log(this.props.questionInfo);var e=f["default"].findDOMNode(this.refs.roundContainer),t=this;wx.ready(function(){console.log("allowRecord"+sessionStorage.allowRecord),sessionStorage.allowRecord&&"true"===sessionStorage.allowRecord||wx.startRecord({success:function(){sessionStorage.allowRecord=!0,t.recordTimer=setTimeout(function(){wx.stopRecord()},500),console.log("here")},cancel:function(){alert("用户拒绝授权录音")}}),e.addEventListener("click",t.clickHandler,!1)}),wx.onVoicePlayEnd({success:function(e){t.setState({status:4})}}),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)}},{key:"routerWillLeave",value:function(e){if(!this.state.answerSuccess)return"您的回答尚未完成，确认离开?"}},{key:"componentWillReceiveProps",value:function(e){if(console.log("nextProps.WXConfig.data=="+JSON.stringify(e.WXConfig.data)),e.WXConfig.data.timestamp){var t=(new Date).valueOf();if(console.log("now==="+t/1e3),console.log("timestamp==="+e.WXConfig.data.timestamp),t/1e3-e.WXConfig.data.timestamp<3){console.log("into config===");var n=["startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","chooseWXPay"],a={};console.log("newWxConfig"),a.debug=!1,a.appId=e.WXConfig.data.appId,a.timestamp=e.WXConfig.data.timestamp.toString(),a.nonceStr=e.WXConfig.data.nonceStr,a.signature=e.WXConfig.data.signature,a.jsApiList=n,console.log("newWxConfig"+JSON.stringify(a)),wx.config(a)}}}},{key:"componentWillUnmount",value:function(){var e=this;clearTimeout(this.state.successTimer);var t=f["default"].findDOMNode(this.refs.roundContainer);wx.ready(function(){t.removeEventListener("click",e.clickHandler,!1)})}},{key:"refreshWXConfig",value:function(){var e=this.props.landPage||location.href;console.log("now get wxconfig for url==="+e),this.props.getWXConfig(e)}},{key:"clickHandler",value:function(e){var t=this,n=function(e){e.preventDefault(),wx.startRecord({success:function(){var e=(new Date).getTime();t.setState({START:e,status:2}),console.log("start at ==="+e)},cancel:function(){alert("用户拒绝授权录音"),t.setState({status:0})}})},a=function(e){var n=(new Date).getTime();return console.log("录音时间"+(n-t.state.START)),n-t.state.START<1e3?(n=0,alert("录音不能小于1秒哦"),wx.stopRecord(),t.setState({status:0}),null):(console.log("录音时间"+(n-t.state.START)),void wx.stopRecord({success:function(e){var n=e.localId;t.setState({localId:n,status:4})},fail:function(e){alert(JSON.stringify(e))}}))},o=function(e){e.preventDefault(),wx.playVoice({localId:t.state.localId})},s=function(e){e.preventDefault(),wx.stopVoice({localId:t.state.localId})},i=function(e){console.log("wait for wx")};switch(t.state.status){case 0:t.setState({status:1}),n(e);break;case 1:i(e);break;case 2:t.setState({status:3}),a(e);break;case 3:i(e);break;case 4:t.setState({status:5}),o(e);break;case 5:s(e),t.setState({status:4})}}},{key:"saveVoice",value:function(e,t){var n,a=this;fetch(C.domain+"/api/v1/answer/answer",(n={credentials:"same-origin",method:"post",headers:{Accept:"application/json","Content-Type":"application/json"}},o(n,"credentials","same-origin"),o(n,"body",JSON.stringify({server_id:e,question_id:t})),n)).then(function(e){return e.json()}).then(function(e){if(0==e.errCode){a.setState({answerSuccess:!0}),a.props.getAskedMe(1,10);var t=setTimeout(function(){p.browserHistory.push(C.baseUrl+"account/AskedMeList")},2e3);a.setState({successTimer:t})}else alert("抱歉，上传失败"),console.log("语音上传失败，原因是"+e.msg)})}},{key:"confirmAnswer",value:function(){var e=this,t=this.state.localId;return null==t?void alert("请先录音哦"):void wx.uploadVoice({localId:t,isShowProgressTips:1,success:function(t){console.log("上传成功了！"),console.log("serverId is ==="+t.serverId);var n=t.serverId,a=e.props.params.id;e.saveVoice(n,a)}})}},{key:"playVoice",value:function(){this.setState({playing:!0})}},{key:"reRecord",value:function(){this.setState({status:0})}},{key:"render",value:function(){var e=this.props.questionInfo,t={0:" ",1:" ",2:" on",3:" on",4:" voice",5:" voice-on"},n={0:u["default"].createElement("div",null,"点击录音"),1:u["default"].createElement("div",null,"开启中"),2:u["default"].createElement("div",null,"正在录音",u["default"].createElement("br",null),"点击停止"),3:u["default"].createElement("div",null,"停止中"),4:u["default"].createElement("div",null,"点击试听"),5:u["default"].createElement("div",null,"播放中")};return u["default"].createElement("div",{className:"accountAnswer"},u["default"].createElement(k["default"],{show:this.state.answerSuccess},"回答成功"),u["default"].createElement(k["default"],{icon:"loading",show:1==this.state.status},"开启中"),u["default"].createElement(k["default"],{icon:"loading",show:3==this.state.status},"停止中"),u["default"].createElement("div",{className:"question"},u["default"].createElement("div",{className:"head"},u["default"].createElement(p.Link,{to:C.baseUrl+"user/"+e.user_id},u["default"].createElement("img",{src:e.user_face})),u["default"].createElement("span",{className:"name"},e.user_name),u["default"].createElement("span",{className:"price"},"￥ ",e.question_prize)),u["default"].createElement("div",{className:"stem"},e.question_content),u["default"].createElement("div",{className:"time"},y["default"].getTimeSpan(e.question_time),"之前")),u["default"].createElement("div",{className:"hint"},"您的回答将被公开，答案每被偷听一次，你就赚 ￥0.3"),u["default"].createElement("div",{className:"replyHint"},n[this.state.status]),u["default"].createElement("div",{ref:"replyContainer",className:"replyContainer"},u["default"].createElement("div",{ref:"roundContainer",className:"round-container "+t[this.state.status]},u["default"].createElement("div",{className:"replyIcon"}),u["default"].createElement("div",{className:"recording"}),u["default"].createElement("div",{className:"bubble-voice"}),u["default"].createElement(E["default"],null))),u["default"].createElement("div",{className:"reRecord",onClick:this.reRecord.bind(this)},"重录"),u["default"].createElement("div",{className:"recordHint"},null==this.state.localId?"点击录音按钮最多可录制60S":"点击试听可试听您最近一次的回答"),u["default"].createElement("div",{className:"sendBtn",onClick:this.confirmAnswer.bind(this)},"发送"))}}]),t}(c.Component);T=(0,p.withRouter)(T),T.contextTypes={router:c.PropTypes.object};var W=function(e){return{questionInfo:e.questionInfo,saveVoiceInfo:e.saveVoiceInfo,WXConfig:e.WXConfig,landPage:e.landPage}};T=(0,m.connect)(W,{getQuestionInfo:v.getQuestionInfo,saveVoice:v.saveVoice,getWXConfig:h.getWXConfig,getAskedMe:g.getAskedMe})(T),t["default"]=T}});
//# sourceMappingURL=0.fe619ab8b7d64ee5a1af.hot-update.js.map